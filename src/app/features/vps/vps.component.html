<!-- Banner -->
<section class="breadcumnd__banner">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <div class="banner__content">
          <h6>{{ text('tabVps') }}</h6>
          <h4>{{ text('getHosting') }}</h4>
          <ul class="ssd__list">
            <li><span><i class="fa-solid fa-arrow-right"></i></span> {{ text('managedPerformance') }}</li>
            <li><span><i class="fa-solid fa-arrow-right"></i></span> {{ text('fasterUnlimited') }}</li>
            <li><span><i class="fa-solid fa-arrow-right"></i></span> {{ text('performanceUnlimited') }}</li>
          </ul>
            <a [href]="whatsappLink" class="hero-cta-btn">
              <span class="btn-text">{{ text('getStartedNow') }}</span>
              <i class="fa-brands fa-whatsapp btn-icon"></i>
              <span class="btn-glow"></span>
            </a>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="banner__Thumb">
          <img src="assets/img/about/vps.png" alt="VPS Hosting" class="img-fluid">
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Filter Overlay & Sidebar -->
<div class="filter-overlay" [class.active]="filterSidebarOpen" (click)="closeFilterSidebar()"></div>

<aside class="filter-sidebar" [class.active]="filterSidebarOpen">
  <div class="filter-sidebar-header">
    <h5 class="filter-sidebar-title" style="color:#00cdfb">
      <i class="fa-solid fa-sliders"></i> {{ text('filterServers') }}
    </h5>
    <button class="close-btn" (click)="closeFilterSidebar()">
      <i class="fa-solid fa-times"></i>
    </button>
  </div>

  <div class="filter-sidebar-content">
    <!-- Plan Name Filter -->
    <div class="filter-group">
      <label class="form-label"><i class="fa-solid fa-tag"></i> {{ text('planName') }}</label>
      <div class="checkbox-group horizontal plan-name-group">
        <label class="checkbox-item" *ngFor="let name of allPlanNames">
          <input type="checkbox"
                 [checked]="isPlanNameSelected(name)"
                 (change)="togglePlanName(name)">
          <span class="checkmark"></span>
          {{ name }}
        </label>
      </div>
      <small class="selected-count" *ngIf="filters.planNames.length > 0">
        {{ filters.planNames.length }} {{ text('selected') }}
        <span class="clear-all-plans" (click)="clearAllPlanNames()">({{ text('clear') }})</span>
      </small>
    </div>

    <!-- CPU Cores -->
    <div class="filter-group">
      <label class="form-label"><i class="fa-solid fa-microchip"></i> {{ text('cpuCores') }}</label>
      <div class="checkbox-group horizontal">
        <label class="checkbox-item" *ngFor="let core of cpuOptions">
          <input type="checkbox" [checked]="isCoreSelected(core)" (change)="toggleCore(core)">
          <span class="checkmark"></span>
          {{ core }} {{ text('core') }}{{ core !== '1' ? 's' : '' }}
        </label>
      </div>
    </div>

    <!-- RAM -->
    <div class="filter-group">
      <label class="form-label"><i class="fa-solid fa-memory"></i> {{ text('ram') }}</label>
      <div class="checkbox-group horizontal">
        <label class="checkbox-item" *ngFor="let ram of ramOptions">
          <input type="checkbox" [checked]="isRamSelected(ram)" (change)="toggleRam(ram)">
          <span class="checkmark"></span>
          {{ ram }} GB
        </label>
      </div>
    </div>

    <!-- Storage Type -->
    <div class="filter-group">
      <label class="form-label"><i class="fa-solid fa-hard-drive"></i> {{ text('storageType') }}</label>
      <div class="checkbox-group horizontal">
        <label class="checkbox-item" *ngFor="let type of storageOptions">
          <input type="checkbox" [checked]="isStorageSelected(type)" (change)="toggleStorage(type)">
          <span class="checkmark"></span>
          {{ type === 'nvme' ? 'NVMe' : type === 'ssd' ? 'SSD' : 'HDD' }}
        </label>
      </div>
    </div>

    <!-- Max Price -->
    <div class="filter-group">
      <label class="form-label"><i class="fa-solid fa-dollar-sign"></i> {{ text('maxPrice') }} (USD)</label>
      <div class="price-slider-container">
        <input type="range" class="price-slider" [(ngModel)]="filters.maxPrice" min="0" max="200" step="5"
               (input)="applyInstantFilter()">
        <div class="price-slider-values">
          <span>${{ filters.maxPrice || 0 }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="filter-actions-instant">
    <button class="btn-clear-all" (click)="resetFilters()" *ngIf="getActiveFilterCount() > 0">
      <i class="fa-solid fa-rotate-right"></i> {{ text('clearAll') }}
    </button>
    <button class="btn-close" (click)="closeFilterSidebar()">
      <i class="fa-solid fa-times"></i> {{ text('close') }}
    </button>
  </div>
</aside>

<!-- Featured Top 3 -->
<section class="featured-servers pt-60 pb-40" *ngIf="!loading && products.length >= 3" id="Best_VPS_Servers">
  <div class="container">
    <div class="section__header text-center">
      <span class="subtitle">{{ text('ourDeals') }}</span>
      <h3 class="section-title">{{ text('bestVpsServers') }}</h3>
      <p class="section-desc">{{ text('moneyBackSupport') }}</p>
    </div>

    <div class="featured-grid">
      <!-- Low Space -->
      <div class="featured-card" *ngIf="getCheapestLowSpace() as plan">
        <div class="badge-discount">{{ text('bestEntry') }}</div>
        <div class="featured-card-header">
          <h4 class="plan-name">{{ plan.name || text('lowSpaceStarter') }}</h4>
          <p class="plan-subtitle-category">{{ plan.category || text('lowSpaceStarter') }}</p>
          <p class="plan-subtitle">{{ text('perfectForTesting') }}</p>
        </div>
        <div class="price-section">
          <div class="price-tag">
            <span class="currency">US$</span>
            <span class="amount">{{ plan.price }}</span>
            <span class="period">/mo</span>
          </div>
        </div>
        <ul class="featured-specs">
          <li><i class="fa-solid fa-microchip"></i> {{ plan.cores }} {{ text('core') }}{{ plan.cores !== 1 ? 's' : '' }}</li>
          <li><i class="fa-solid fa-memory"></i> {{ plan.ramGB }} GB {{ text('ramLabel') }}</li>
          <li><i class="fa-solid fa-hard-drive"></i> {{ plan.storageGB }} GB {{ (plan.storageType || 'SSD') | uppercase }}</li>
        </ul>
        <div class="featured-card-footer">
          <button class="btn-order" (click)="orderNow(plan.id)">
            <span>{{ text('orderNow') }}</span>
            <i class="fa-solid fa-arrow-right"></i>
          </button>
          <div class="limited-time-deal"><span>{{ text('limitedDeal') }}</span></div>
        </div>
      </div>

      <!-- High Space (Popular) -->
      <div class="featured-card popular" *ngIf="getCheapestHighSpace() as plan">
        <div class="badge-popular">{{ text('mostStorage') }}</div>
        <div class="featured-card-header">
          <h4 class="plan-name">{{ plan.name }}</h4>
          <p class="plan-subtitle-category">{{  plan.category || text('storageKing') }}</p>
          <p class="plan-subtitle">{{ text('massiveStorage') }}</p>
        </div>
        <div class="price-section">
          <div class="price-tag">
            <span class="currency">US$</span>
            <span class="amount">{{ plan.price }}</span>
            <span class="period">/mo</span>
          </div>
        </div>
        <ul class="featured-specs">
          <li><i class="fa-solid fa-microchip"></i> {{ plan.cores }} {{ text('core') }}{{ plan.cores !== 1 ? 's' : '' }}</li>
          <li><i class="fa-solid fa-memory"></i> {{ plan.ramGB }} GB {{ text('ramLabel') }}</li>
          <li><i class="fa-solid fa-hard-drive"></i> {{ plan.storageGB }} GB {{ (plan.storageType || 'SSD') | uppercase }}</li>
        </ul>
        <div class="featured-card-footer">
          <button class="btn-order" (click)="orderNow(plan.id)">
            <span>{{ text('orderNow') }}</span>
            <i class="fa-solid fa-arrow-right"></i>
          </button>
          <div class="limited-time-deal"><span>{{ text('limitedDeal') }}</span></div>
        </div>
      </div>

      <!-- Best Value Per Core -->
      <div class="featured-card" *ngIf="getCheapestByCore() as plan">
        <div class="badge-discount">{{ text('bestPerCore') }}</div>
        <div class="featured-card-header">
          <h4 class="plan-name">{{ plan.name}}</h4>
          <p class="plan-subtitle-category">{{  plan.category || text('cpuChampion') }}</p>
          <p class="plan-subtitle">{{ text('maxPowerPerDollar') }}</p>
        </div>
        <div class="price-section">
          <div class="price-tag">
            <span class="currency">US$</span>
            <span class="amount">{{ plan.price }}</span>
            <span class="period">/mo</span>
          </div>
        </div>
        <ul class="featured-specs">
          <li><i class="fa-solid fa-microchip"></i> {{ plan.cores }} {{ text('core') }}{{ plan.cores !== 1 ? 's' : '' }}</li>
          <li><i class="fa-solid fa-memory"></i> {{ plan.ramGB }} GB {{ text('ramLabel') }}</li>
          <li><i class="fa-solid fa-hard-drive"></i> {{ plan.storageGB }} GB {{ (plan.storageType || 'SSD') | uppercase }}</li>
        </ul>
        <div class="featured-card-footer">
          <button class="btn-order" (click)="orderNow(plan.id)">
            <span>{{ text('orderNow') }}</span>
            <i class="fa-solid fa-arrow-right"></i>
          </button>
          <div class="limited-time-deal"><span>{{ text('limitedDeal') }}</span></div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- All Plans with Space Tabs -->
<section class="pricing__domain pt-60 pb-120" id="highspace">
  <div class="container-fluid px-4">
    <div class="section__header text-center">
      <span class="subtitle">{{ text('completeRange') }}</span>

      <!-- NEW: LowSpace / HighSpace Tabs -->
      <div class="processor-tabs space-tabs">
        <button class="processor-tab"
                [class.active]="spaceFilter === 'all'"
                (click)="setSpaceFilter('all')">
          <i class="fa-solid fa-server"></i> {{ text('all') }}
        </button>
        <button class="processor-tab low-space-tab"
                [class.active]="spaceFilter === 'low'"
                (click)="setSpaceFilter('low')">
          <i class="fa-solid fa-hdd"></i> LowSpace
        </button>
        <button class="processor-tab high-space-tab"
                [class.active]="spaceFilter === 'high'"
                (click)="setSpaceFilter('high')">
          <i class="fa-solid fa-database"></i> HighSpace
        </button>
      </div>

      <h3 class="section-title d-flex justify-content-center align-items-center gap-3 flex-wrap">
        <div class="filter-title-group">
          <span class="filter-title-text">{{ text('filter') }}</span>
          <button class="filter-toggle-btn-inline"
                  [class.active]="filterSidebarOpen || getActiveFilterCount() > 0"
                  (click)="toggleFilterSidebar()">
            <i class="fa-solid fa-sliders" [class.fa-times]="filterSidebarOpen"></i>
            <span class="filter-count-badge" *ngIf="getActiveFilterCount() > 0">{{ getActiveFilterCount() }}</span>
          </button>
        </div>
        <span class="all-plans-text">{{ text('allVpsPlans') }}</span>
      </h3>

      <p class="section-desc">
        {{ filtered.length }} {{ text('server') }}{{ filtered.length !== 1 ? 's' : '' }} {{ text('found') }}
        <span class="filter-text" *ngIf="getActiveFilterCount() > 0 || spaceFilter !== 'all'">
          â€¢ {{ getActiveFilterCount() + (spaceFilter !== 'all' ? 1 : 0) }} {{ text('filter') }}{{ getActiveFilterCount() + (spaceFilter !== 'all' ? 1 : 0) > 1 ? 's' : '' }} {{ text('applied') }}
        </span>
      </p>
    </div>

    <!-- Loading / Error / No Results -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner"></div>
      <p>{{ text('loadingVps') }}</p>
    </div>

    <div class="error-state" *ngIf="error && !loading">
      <i class="fa-solid fa-exclamation-triangle"></i>
      <h4>{{ text('errorOccurred') }}</h4>
      <p>{{ error }}</p>
      <button class="btn-retry" (click)="loadProducts()">
        <i class="fa-solid fa-rotate-right"></i> {{ text('tryAgain') }}
      </button>
    </div>

    <div class="no-results-enhanced" *ngIf="!loading && filtered.length === 0">
      <div class="no-results-icon"><i class="fa-solid fa-server"></i></div>
      <h4 class="no-results-title">{{ text('noServersFound') }}</h4>
      <p class="no-results-subtitle">{{ text('noVpsMatching') }}</p>
      <button class="btn btn-primary" (click)="resetFilters()">
        <i class="fa-solid fa-rotate-right"></i> {{ text('clearAllFilters') }}
      </button>
    </div>

    <!-- All Plans Grid -->
    <div class="featured-grid all-plans-grid" *ngIf="!loading && filtered.length > 0">
      <div class="featured-card" *ngFor="let p of filtered; trackBy: trackByFn">
        <div class="badge-discount" *ngIf="p.discount">{{ p.discount }} OFF</div>

        <div class="featured-card-header">
          <h4 class="plan-name">{{ p.name }}</h4>
          <p class="plan-subtitle-category">{{  p.category }}</p>
          <p class="plan-subtitle">{{ text('highPerformanceRoot') }}</p>
        </div>

        <div class="price-section">
          <div class="price-tag">
            <span class="currency">US$</span>
            <span class="amount">{{ p.price }}</span>
            <span class="period">/mo</span>
          </div>
        </div>

        <ul class="featured-specs">
          <li><i class="fa-solid fa-microchip"></i> {{ p.cores }} {{ text('cpuCores') }}</li>
          <li><i class="fa-solid fa-memory"></i> {{ p.ramGB }} GB {{ text('ramLabel') }}</li>
          <li><i class="fa-solid fa-hard-drive"></i> {{ p.storageGB }} GB {{ (p.storageType || 'SSD') | uppercase }}</li>
          <li *ngIf="p.connectionSpeed"><i class="fa-solid fa-gauge-high"></i> {{ p.connectionSpeed }}</li>
        </ul>

        <div class="featured-card-footer">
          <button class="btn-order" (click)="orderNow(p.id)">
            <span>{{ text('orderNow') }}</span>
            <i class="fa-solid fa-arrow-right"></i>
          </button>
          <div class="limited-time-deal" *ngIf="p.limited">
            <span>{{ text('limitedDeal') }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
