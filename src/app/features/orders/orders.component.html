<!-- Breadcrumb Banner -->
<section class="breadcumnd__banner" *ngIf="!loading && product">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-12">
        <div class="banner__content">
          <h6>{{ t('completeYourPurchase') }}</h6>
          <h4>{{ t('checkout') }}</h4>
          <ul>
            <li><a href="/">{{ t('home') }}</a></li>
            <li><i class="fas fa-chevron-right"></i></li>
            <li>{{ t('checkout') }}</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Order Section -->
<section class="pricing__section pt-120 pb-120" *ngIf="!loading && product; else loadingTemplate">
  <div class="container">
    <div class="row g-4 justify-content-center">

      <!-- Product Summary -->
      <div class="col-lg-5">
        <div class="pricing__itmes product-summary">
          <div class="header-pricing">
            <h4 class="title">{{ product.name }}</h4>
            <h6 class="mb-3">
              <span class="home__theme">${{ product.price }}</span>
              <span class="month">/month</span>
            </h6>
          </div>

          <ul class="mb-30">
            <li>
              <i class="fas fa-microchip text-base"></i>
              <span>{{ product.cores ?? 0 }} {{ (product.cores ?? 0) > 1 ? t('cores_plural') : t('cores') }}</span>
            </li>
            <li>
              <i class="fas fa-memory text-base"></i>
              <span>{{ product.ramGB ?? 0 }} GB {{ t('ram') }}</span>
            </li>
            <li>
              <i class="fas fa-hard-drive text-base"></i>
              <span>{{ product.storageGB ?? 0 }} GB {{ (product.storageType || 'NVMe') | uppercase }}</span>
            </li>
            <li>
              <i class="fas fa-shield-alt text-base"></i>
              <span>{{ t('moneyBackGuarantee') }}</span>
            </li>
            <li>
              <i class="fas fa-headset text-base"></i>
              <span>{{ t('technicalSupport') }}</span>
            </li>
          </ul>

          <div class="text-center"></div>
        </div>
      </div>

      <!-- Checkout Form -->
      <div class="col-lg-7">
        <div class="contact__section">
          <div id="form">
            <h3 class="text-center mb-4">{{ t('completeYourOrder') }}</h3>

            <form [formGroup]="orderForm" (ngSubmit)="submitOrder()">

              <!-- Full Name -->
              <div class="form-control" [class.error]="orderForm.get('customerName')?.invalid && orderForm.get('customerName')?.touched">
                <label for="customerName">{{ t('fullName') }} *</label>
                <input
                  type="text"
                  id="customerName"
                  formControlName="customerName"
                  [placeholder]="t('enterFullName')"
                />
                <small *ngIf="orderForm.get('customerName')?.hasError('required') && orderForm.get('customerName')?.touched">
                  {{ t('nameRequired') }}
                </small>
                <small *ngIf="orderForm.get('customerName')?.hasError('minlength') && orderForm.get('customerName')?.touched">
                  {{ t('nameMinLength') }}
                </small>
              </div>

              <!-- WhatsApp Number -->
              <div class="form-control" [class.error]="orderForm.get('phoneNumber')?.invalid && orderForm.get('phoneNumber')?.touched">
                <label for="phoneNumber">{{ t('whatsappNumber') }} *</label>
                <input
                  type="tel"
                  id="phoneNumber"
                  formControlName="phoneNumber"
                  [placeholder]="t('enterWhatsapp')"
                />
                <small *ngIf="orderForm.get('phoneNumber')?.hasError('required') && orderForm.get('phoneNumber')?.touched">
                  {{ t('phoneRequired') }}
                </small>
                <small *ngIf="orderForm.get('phoneNumber')?.hasError('pattern') && orderForm.get('phoneNumber')?.touched">
                  {{ t('invalidEgyptPhone') }}
                </small>
              </div>

              <!-- Payment Methods -->
              <div class="form-control">
                <label>{{ t('selectPaymentMethod') }} *</label>
                <div class="payment-methods-grid">

                  <!-- Vodafone Cash -->
                  <div class="payment-method-card"
                       [class.active]="orderForm.get('paymentMethod')?.value === 'vodafone_cash'"
                       (click)="orderForm.patchValue({ paymentMethod: 'vodafone_cash' })">
                    <input type="radio" formControlName="paymentMethod" value="vodafone_cash" hidden />
                    <div class="method-header">
                      <img src="/assets/img/footer/vodcash.jpg" alt="Vodafone Cash" style="width:24px;">
                      <span>{{ t('vodafoneCash') }}</span>
                      <i class="fas fa-check-circle check-icon"></i>
                    </div>
                    <div class="method-details" *ngIf="orderForm.get('paymentMethod')?.value === 'vodafone_cash'">
                      <div class="qr-section">
                        <img src="assets/img/payment-qr/vodafoncashQR.jpeg" alt="Vodafone Cash QR" class="qr-code">
                        <div class="payment-info">
                          <div class="account-number">0106 319 4547</div>
                          <div class="account-name">Ahmed Samir</div>
                          <div class="payment-amount">
                            {{ t('sendAmount') }} <strong class="home__theme">${{ product.price }}</strong>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- InstaPay -->
                  <div class="payment-method-card"
                       [class.active]="orderForm.get('paymentMethod')?.value === 'instapay'"
                       (click)="orderForm.patchValue({ paymentMethod: 'instapay' })">
                    <input type="radio" formControlName="paymentMethod" value="instapay" hidden />
                    <div class="method-header">
                      <img src="/assets/img/footer/insta.png" alt="InstaPay" style="width:24px;">
                      <span>{{ t('instapay') }}</span>
                      <i class="fas fa-check-circle check-icon"></i>
                    </div>
                    <div class="method-details" *ngIf="orderForm.get('paymentMethod')?.value === 'instapay'">
                      <div class="qr-section">
                        <img src="assets/img/payment-qr/instapayQR.jpeg" alt="InstaPay QR" class="qr-code">
                        <div class="payment-info">
                          <div class="account-number">0106 319 4547</div>
                          <div class="account-name">topservers4{{ '@' }}instapay</div>
                          <div class="payment-amount">
                            {{ t('sendAmount') }} <strong class="home__theme">${{ product.price }}</strong>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Binance Pay -->
                  <div class="payment-method-card"
                       [class.active]="orderForm.get('paymentMethod')?.value === 'binance'"
                       (click)="orderForm.patchValue({ paymentMethod: 'binance' })">
                    <input type="radio" formControlName="paymentMethod" value="binance" hidden />
                    <div class="method-header">
                      <img src="/assets/img/footer/biance.png" alt="Binance Pay" style="width:24px;">
                      <span>{{ t('binance') }}</span>
                      <i class="fas fa-check-circle check-icon"></i>
                    </div>
                    <div class="method-details" *ngIf="orderForm.get('paymentMethod')?.value === 'binance'">
                      <div class="binance-section">
                        <div class="binance-id">42280170</div>
                        <div class="binance-email">topresvers000{{ '@' }}gmail.com</div>
                        <div class="payment-amount">
                          {{ t('sendAmount') }} <strong class="home__theme">${{ product.price }}</strong> USDT<br>
                          <small>(TRC20 or BEP20 Network)</small>
                        </div>
                      </div>
                    </div>
                  </div>

                </div>
                <small *ngIf="orderForm.get('paymentMethod')?.invalid && orderForm.get('paymentMethod')?.touched">
                  {{ t('pleaseSelectPayment') }}
                </small>
              </div>

              <!-- Upload Payment Screenshot -->
              <div class="form-control">
                <label for="paymentImage">{{ t('paymentScreenshot') }}</label>
                <div class="file-upload-wrapper" (click)="fileInput.click()">
                  <input #fileInput type="file" accept="image/*" (change)="onFileSelected($event)" hidden />
                  <div class="file-upload-content">
                    <i class="fas fa-camera"></i>
                    <span *ngIf="!selectedFile">{{ t('clickToUpload') }}</span>
                    <span *ngIf="selectedFile" class="file-selected">
                      <i class="fas fa-check text-base"></i> {{ selectedFile.name }}
                      <button type="button" class="remove-file" (click)="$event.stopPropagation(); removeFile()">
                        <i class="fas fa-times"></i>
                      </button>
                    </span>
                  </div>
                </div>
              </div>

              <!-- Additional Notes -->
              <div class="form-control">
                <label for="notes">{{ t('additionalNotes') }}</label>
                <textarea
                  id="notes"
                  formControlName="notes"
                  rows="3"
                  [placeholder]="t('notesPlaceholder')">
                </textarea>
              </div>

              <!-- Action Buttons -->
              <div class="action-buttons">
                <button type="button" class="cmn--btn border__trans" (click)="goBack()" style="background-color: red;">
                  <span><i class="fas fa-arrow-left"></i> {{ t('back') }}</span>
                </button>
                <button type="submit" class="cmn--btn" [disabled]="submitting || orderForm.invalid">
                  <span>
                    <i class="fas"
                       [ngClass]="{
                         'fa-spinner fa-spin': submitting,
                         'fa-check': !submitting
                       }"></i>
                    {{ submitting ? t('processing') : t('confirmOrder') }}
                  </span>
                </button>
              </div>

              <!-- Success Message -->
              <div class="alert alert-success" *ngIf="successMessage">
                <i class="fas fa-check-circle"></i>
                {{ successMessage }}
              </div>

              <!-- Error Message -->
              <div class="alert alert-error" *ngIf="error">
                <i class="fas fa-exclamation-circle"></i>
                {{ error }}
              </div>

            </form>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- Loading Template -->
<ng-template #loadingTemplate>
  <section class="pt-120 pb-120">
    <div class="container">
      <div class="loading-wrapper">
        <div class="spinner-border text-base" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">{{ t('loadingOrderDetails') }}</p>
      </div>
    </div>
  </section>
</ng-template>
