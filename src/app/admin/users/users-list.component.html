<div class="admin-shell">
  <app-admin-sidebar></app-admin-sidebar>
  <div class="admin-area">
    <app-admin-topbar></app-admin-topbar>

    <main class="admin-main">
    <div class="top">
      <h1>Users Management</h1>
      <button class="btn primary" (click)="addNew()">Add New User</button>
    </div>

    <div *ngIf="loading">Loading users...</div>
    <div *ngIf="error" class="error">{{ error }}</div>

    <table *ngIf="!loading && users.length" class="users-table">
      <thead>
        <tr>
          <th>Id</th>
          <th>Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Role</th>
          <th>Created At</th>
          <th>Blocked</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let u of users">
          <td>{{ u.id }}</td>
          <td>{{ u.name || u.Name }}</td>
          <td>{{ u.email || u.Email }}</td>
          <td>{{ u.phoneNumber || u.PhoneNumber || u.phone || u.Phone }}</td>
          <td>{{ u.role || u.Role }}</td>
          <td>{{ u.createdAt || u.CreatedAt }}</td>
          <td>{{ u.isBlocked || u.IsBlocked ? 'Yes' : 'No' }}</td>
          <td>
            <button class="btn" (click)="edit(u)">Edit</button>
            <button class="btn" (click)="openQuickEdit(u)">Quick Edit</button>
            <button class="btn" (click)="toggleBlock(u)">{{ u.isBlocked || u.IsBlocked ? 'Unblock' : 'Block' }}</button>
            <button class="btn danger" (click)="deleteUser(u)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!loading && !users.length">No users found.</div>
    <app-user-quick-edit *ngIf="quickEditVisible" [user]="editingUser" (saved)="onQuickSaved($event)" (cancel)="quickEditVisible=false"></app-user-quick-edit>
    <app-confirm-dialog *ngIf="confirmVisible" [title]="'Delete user'" [message]="'Delete user ' + (confirmTarget?.name || confirmTarget?.email || '') + '?'" (confirm)="onConfirmDelete()" (cancel)="onCancelDelete()"></app-confirm-dialog>
  </main>
</div>
